{% extends 'base-personal.html' %}
{% block personal_content %}
{% load static %}
		<link href="{% static 'css/consumer/orstyle.css' %}" rel="stylesheet" type="text/css">
					<div class="user-order">
						<!--标题 -->
						<div class="am-cf am-padding">
							<div class="am-fl am-cf"><strong class="am-text-danger am-text-lg">退换货管理</strong> / <small>Change</small></div>
						</div>
						<hr/>

						<div class="am-tabs am-tabs-d2 am-margin" data-am-tabs>

							<ul class="am-avg-sm-2 am-tabs-nav am-nav am-nav-tabs">
								<li class="am-active" data-method="refunding" id="refunding"><a href="#tab1">正在退款</a></li>
								<li><a href="#tab2" data-method="refund_succeed" id="refund_succeed">退款成功</a></li>

							</ul>

							<div class="am-tabs-bd">
								<div class="am-tab-panel am-fade am-in am-active" id="tab1">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-orderprice th-price">
											<td class="td-inner">交易金额</td>
										</div>
										<div class="th th-changeprice th-price">
											<td class="td-inner">退款金额</td>
										</div>
										<div class="th th-status th-moneystatus">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change th-changebuttom">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list-returning">
											<!--退款订单显示-->
											<div class="order-title">
												<div class="dd-num">退款编号：<a href="javascript:;">1601430</a></div>
												<span>申请时间：2015-12-20</span>
												<!--    <em>店铺：小桔灯</em>-->
											</div>
											<div class="order-content">
												<div class="order-left">
													<ul class="item-list">
														<li class="td td-item">
															<div class="item-pic">
																<a href="#" class="J_MakePoint">
																	<img src="../images/kouhong.jpg_80x80.jpg" class="itempic J_ItemImg">
																</a>
															</div>
															<div class="item-info">
																<div class="item-basic-info">
																	<a href="#">
																		<p>美康粉黛醉美唇膏 持久保湿滋润防水不掉色</p>
																		<p class="info-little">颜色：12#川南玛瑙
																			<br/>包装：裸装 </p>
																	</a>
																</div>
															</div>
														</li>

														<ul class="td-changeorder">
															<li class="td td-orderprice">
																<div class="item-orderprice">
																	<span>交易金额：</span>72.00
																</div>
															</li>
															<li class="td td-changeprice">
																<div class="item-changeprice">
																	<span>退款金额：</span>70.00
																</div>
															</li>
														</ul>
														<div class="clear"></div>
													</ul>

													<div class="change move-right">
														<li class="td td-moneystatus td-status">
															<div class="item-status">
																<p class="Mystatus">退款成功</p>

															</div>
														</li>
													</div>
													<li class="td td-change td-changebutton">
														<a href="record.html">
														<div class="am-btn am-btn-danger anniu">
															钱款去向</div>
														</a>
													</li>

												</div>
											</div>
										</div>

									</div>

								</div>
								<div class="am-tab-panel am-fade" id="tab2">
									<div class="order-top">
										<div class="th th-item">
											<td class="td-inner">商品</td>
										</div>
										<div class="th th-orderprice th-price">
											<td class="td-inner">交易金额</td>
										</div>
										<div class="th th-changeprice th-price">
											<td class="td-inner">退款金额</td>
										</div>
										<div class="th th-status th-moneystatus">
											<td class="td-inner">交易状态</td>
										</div>
										<div class="th th-change th-changebuttom">
											<td class="td-inner">交易操作</td>
										</div>
									</div>

									<div class="order-main">
										<div class="order-list-refund-success">
<!--											<div class="order-title">-->
<!--												<div class="dd-num">退款编号：<a href="javascript:;">1601430</a></div>-->
<!--												<span>申请时间：2015-12-20</span>-->
<!--												&lt;!&ndash;    <em>店铺：小桔灯</em>&ndash;&gt;-->
<!--											</div>-->
<!--											<div class="order-content">-->
<!--												<div class="order-left">-->
<!--													<ul class="item-list">-->
<!--														<li class="td td-item">-->
<!--															<div class="item-pic">-->
<!--																<a href="#" class="J_MakePoint">-->
<!--																	<img src="../images/kouhong.jpg_80x80.jpg" class="itempic J_ItemImg">-->
<!--																</a>-->
<!--															</div>-->
<!--															<div class="item-info">-->
<!--																<div class="item-basic-info">-->
<!--																	<a href="#">-->
<!--																		<p>美康粉黛醉美唇膏 持久保湿滋润防水不掉色</p>-->
<!--																		<p class="info-little">颜色：12#川南玛瑙-->
<!--																			<br/>包装：裸装 </p>-->
<!--																	</a>-->
<!--																</div>-->
<!--															</div>-->
<!--														</li>-->

<!--														<ul class="td-changeorder">-->
<!--															<li class="td td-orderprice">-->
<!--																<div class="item-orderprice">-->
<!--																	<span>交易金额：</span>72.00-->
<!--																</div>-->
<!--															</li>-->
<!--															<li class="td td-changeprice">-->
<!--																<div class="item-changeprice">-->
<!--																	<span>退款金额：</span>70.00-->
<!--																</div>-->
<!--															</li>-->
<!--														</ul>-->
<!--														<div class="clear"></div>-->
<!--													</ul>-->

<!--													<div class="change move-right">-->
<!--														<li class="td td-moneystatus td-status">-->
<!--															<div class="item-status">-->
<!--																<p class="Mystatus">退款成功</p>-->

<!--															</div>-->
<!--														</li>-->
<!--													</div>-->
<!--													<li class="td td-change td-changebutton">-->
<!--                                                        <a href="record.html">-->
<!--														    <div class="am-btn am-btn-danger anniu">-->
<!--															钱款去向</div>-->
<!--														</a>-->
<!--													</li>-->

<!--												</div>-->
<!--											</div>-->
<!--										</div>-->
									</div>

								</div>

							</div>

						</div>
					</div>
					</div>
<script>
	layui.use('flow',function () {
		let $ = layui.jquery;
		let flow = layui.flow;  // 流加载
		flows('9','.order-list-refund-success');
		let active = {
			refund_succeed:function () {
				flows('9','.order-list-refund-success');
					},
			refunding:function () {
				flows('8','.order-list-refunding');
					},
		};

		$("#refund_succeed,#refunding").click(function () {
			let othis = $(this);
			let method = othis.data('method');
			active[method] ? active[method].call(this,othis) : '';
		});

		function flows(order_status,dom) {
			flow.load({
				elem: dom,
				done: function (page, next) {
					var list_basic = [];
					var list_details = [];
					$.ajax({
						type: 'GET',
						url: '/order/order-refund-chsc-api/?page=' + page+'&status='+order_status,
						dataType: 'json',
						success: function (data) {
							$.each(data, function (index, order_basic) {  // 列表对象
								let order_id = order_basic.order_id; // 订单号
								let trade_number = order_basic.trade_number; // 交易单号
								let total_price = order_basic.total_price; // 总价钱
								let commodity_total_counts = order_basic.commodity_total_counts; //总商品数量
								let status = order_basic.status; // 当前订单状态
								let order_details = order_basic.order_details; // 订单中每个商品详情
								let generate_time = order_basic.generate_time;  // 订单成交时间
								var total_freight = 0;                    //总运费

								$.each(order_details, function (index, order_details) {   // 先遍历子结构
									let commodity_counts = order_details.commodity_counts; // 商品数量
									let commodity = order_details.commodity[0];
									let commodity_content = '\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ul class="item-list">\n' + '\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-item">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-pic">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#" class="J_MakePoint">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<img src="../images/kouhong.jpg_80x80.jpg" class="itempic J_ItemImg">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-info">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-basic-info">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<a href="#">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>' + commodity.category + '</p>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="info-little">种类：' + commodity.category + '\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br/>商品名：' + commodity.commodity_name + '\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<br/>店铺：' + commodity.store_name + ' </p>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</a>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-price">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-price">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t' + order_details.price + '\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-number">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-number">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<span>×</span>' + commodity_counts + '\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-operation">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-operation">\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
											'\t\t\t\t\t\t\t\t\t\t\t\t\t\t</ul>\n';
									//$(".order-left").append(commodity_content);
									list_details.push(commodity_content);
								});
								let content = '<div class="order-status5">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t<div class="order-title">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="dd-num">订单编号：<a href="javascript:;">' + order_id + '</a></div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t<span>成交时间：' + generate_time + '</span>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t<div class="order-content">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="order-left">\n' +
										list_details.join('') +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="order-right">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-amount">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-amount">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t合计：' + total_price + '\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>含运费：<span>' + total_freight + '</span></p>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="move-right">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-status">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="item-status">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="Mystatus">' + status + '</p>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="order-info"><a href="orderinfo.html">订单详情</a></p>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p class="order-info"><a href="logistics.html">查看物流</a></p>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<li class="td td-change">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class="am-btn am-btn-danger anniu delete_order" data-method="delete_order">\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t删除订单</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</li>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t\t</div>\n' +
										'\t\t\t\t\t\t\t\t\t\t\t</div>';
								//$(".order-list0").append(content);
								list_basic.push(content); // 添加进队列
								list_details = [];
							});
							setTimeout(function () {
								next(list_basic.join(''), page < 10);
							}, 500);
						},
						error: function () {
							layer.msg('服务器无响应', {icon: 2, time: 1500, closeBtn: 0});
						},
					});
				}
			});
		}

	});
</script>
{% endblock %}
