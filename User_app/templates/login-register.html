<!DOCTYPE html>
<html lang="en">
     <head>
		<meta charset="UTF-8">
		<title>吃货商城</title>
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<meta name="format-detection" content="telephone=no">
		<meta name="renderer" content="webkit">
		<meta http-equiv="Cache-Control" content="no-siteapp" />
		<link href="https://cdn.bootcss.com/amazeui/2.5.1/css/amazeui.css" rel="stylesheet" type="text/css" />
        {% load static %}
		<link href="{% static 'css/mainsite/dlstyle.css' %}" rel="stylesheet" type="text/css">
		<script src="https://www.jq22.com/jquery/jquery-1.10.2.js"></script>
        <link rel="stylesheet" type="text/css" href="{% static 'layui/css/layui.css' %}">
		<!--<link rel="stylesheet" type="text/css" href="{% static 'css/mainsite/style.css' %}">-->
        <script src="{% static 'layui/layui.js' %}"></script>
		<script src="https://cdn.bootcss.com/amazeui/2.5.1/js/amazeui.min.js"></script>
		<script src="https://cdn.staticfile.org/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
		<!--<script src="{% static 'validate/js/validators.min.js' %}"></script>-->
		<!--<script src="{% static 'js/mainsite/validators.js' %}"></script>-->

     </head>
     <body>

        <div class="boxtitle">
			<a href=""><img alt="" src="" /></a>
		</div>

        <div class="banner">
			<div class="main">
				<div class="banner-bg"><span></span><img src="" /></div>
				<div class="box">

     {% block login-or-register %}

     {% endblock %}
                </div>
            </div>
        </div>
					<div class="footer ">
						<div class="footer-hd ">
							<p>
								<a href="# ">恒望科技</a>
								<b>|</b>
								<a href="# ">商城首页</a>
								<b>|</b>
								<a href="# ">支付宝</a>
								<b>|</b>
								<a href="# ">物流</a>
							</p>
						</div>
						<div class="footer-bd ">
							<p>
								<a href="# ">关于恒望</a>
								<a href="# ">合作伙伴</a>
								<a href="# ">联系我们</a>
								<a href="# ">网站地图</a>
								<em>© 2016-2026 XXXX 版权所有 <a href="http://www.cssmoban.com/" target="_blank" title="版权所有">版权所有</a> - Collect from</em>
							</p>
						</div>
					</div>
     </body>

    <script>
        layui.use(['layer','form'],function(){
           let form = layui.form;
           let layer = layui.layer;
           let $ = layui.jquery;
           let csrftoken = $.cookie("csrftoken");
           const reg_email = new RegExp("^[a-z0-9]+([._\\-]*[a-z0-9])*@([a-z0-9]+[-a-z0-9]*[a-z0-9]+.){1,63}[a-z0-9]+$"); //邮箱验证
           const reg_phone = new RegExp("^1[3456789]\d{9}$"); //手机号验证
           const reg_username = new RegExp("[\u4e00-\u9fa5]{1,10}|[a-zA-Z0-9]{8,20}");//用户名验证
           const reg_password = new RegExp("[a-zA-Z0-9]{8,20}"); //密码验证


       $(document).ready(function() {

         const count = 60;
         // 倒计时函数
         function SetRemainTime1() {
            if (curCount1 == 0) {
               window.clearInterval(InterValObj1); //停止计时器
               $(".send_code").removeAttr("disabled"); //启用按钮
               $(".send_code").val("重新发送");
               $(".send_code").removeClass("verify_ing");
            } else {
               curCount1--;
               $(".send_code").val(+curCount1 + "秒再获取");
            }
         }

          var next = window.location.search;


          var active = {


           register_page:function(){
              window.location.href = '/consumer/register/'+next;
             },

           login_page:function(){
              window.location.href = '/consumer/login/'+next;
             },

           login:function(){
              let username = $("#user").val();
              let password = $("#password").val();
              let isRemember = $("#remember").is(":checked");
              if(username === ''){
                 layer.msg('请输入用户名',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password === ''){
                 layer.msg('请输入密码',{icon:7,time:1200,closeBtn:0});
                 }
              else{
                 let data = {'login_id':username,'password':password,'next':next,'isRemember':isRemember};
                 let headers = {'X-CSRFToken':csrftoken};
                 let url = '/consumer/login-chsc-api/';
                 layer.load(0, {time: 10000});
                 $.ajax({
                   url:url,
                   type:'POST',
                   data:data,
                   headers:headers,
                   success:function(data){
                       if(data.code === 11){
                          layer.msg('登录成功，正在跳转...',{icon:1,time:500,closeBtn:0});
                          setTimeout(function(){   //延迟500ms执行
                                layer.closeAll('msg');
                                window.location.href = data.previous_page;  //父页采用parent，当前页采用window，最外层页采用top，实现重定向
                            },100);
                          }
                       else if(data.code === -10){
                          layer.msg('登录名或登录密码不正确！',{icon:2,time:1200,closeBtn:0});
                          }
                       else if(data.code === 500){
                          layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                          }
                       layer.closeAll('loading');
                   },
                   error:function(){
                       layer.msg('服务器无响应！',{icon:2,time:1200,closeBtn:0});
                       layer.closeAll('loading');
                      },
                 });
              }
           },

           email_register:function(){
              let email = $("#email").val();
              let password = $("#password_email").val();
              let password_repeat = $("#password_repeat").val();
              let code = $("#code_email").val();
              if(email === ''){
                 layer.msg('请输入邮箱',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password === ''){
                 layer.msg('请输入密码',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password_repeat === ''){
                 layer.msg('请再次确认密码',{icon:7,time:1200,closeBtn:0});
                 }
              else if(!reg_email.test(email)){
                 layer.msg('邮箱格式不规范,请输入正确的邮箱格式!',{icon:7,time:1200,closeBtn:0});
                 }
              else{
                 let data = {'email':email,'password':password,'verification_code':code,'way':'email'};
                 let headers = {'X-CSRFToken':csrftoken};
                 let url = '/consumer/register-chsc-api/';
                 layer.load(0, {time: 10000});
                $.ajax({
                   url:url,
                   headers:headers,
                   type:'POST',
                   data:data,
                   success:function(data){
                       if(data.code === 21){
                          layer.msg('注册成功，正在跳转...',{icon:1,time:1000,closeBtn:0});
                          
                          }
                       else if(data.code === 7){
                          layer.msg('用户已经存在！',{icon:2,time:1200,closeBtn:0});
                          }
                       else if(data.code === 0){
                          layer.msg('验证码错误！',{icon:2,time:1200,closeBtn:0});
                          }
                       else if(data.code === 500){
                          layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                          }
                       layer.closeAll('loading');
                   },
                   error:function(){
                          layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                          layer.closeAll('loading');
                   },
                });
              }
           },

           phone_register:function(){
              let phone = $("#phone").val();
              let password = $("#password_phone").val();
              let password_repeat = $("#passwordRepeat_phone").val();
              let code = $("#code_phone").val();
              if(phone === ''){
                 layer.msg('请输入手机号',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password === ''){
                 layer.msg('请输入密码',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password_repeat === ''){
                 layer.msg('请再次确认密码',{icon:7,time:1200,closeBtn:0});
                 }
              else if(password_repeat != password){
                 layer.msg('两次的密码不一致',{icon:7,time:1200,closeBtn:0});
                 }
              else if(!reg_email.test(email)){
                 layer.msg('手机号码不规范,请输入正确的手机号!',{icon:7,time:1200,closeBtn:0});
                 }
              else{
                 let data = {'user_id':phone,'password':password,'verification_code':code,'way':'phone'};
                 let headers = {'X-CSRFToken':csrftoken};
                 let url = '/consumer/register-chsc-api/';
                 layer.load(0, {time: 10000});
                 $.ajax({
                    url:url,
                    type:'POST',
                    headers:headers,
                    data:data,
                    success:function(data){
                       if(data.code === 21){
                          layer.msg('注册成功，正在跳转...',{icon:1,time:1000,closeBtn:0});
                          }
                       else if(data.code === 7){
                          layer.msg('用户已经存在！',{icon:2,time:1200,closeBtn:0});
                          }
                       else if(data.code === 0){
                          layer.msg('验证码错误！',{icon:2,time:1200,closeBtn:0});
                          }
                       else if(data.code === -20){
                          layer.msg('无响应,网络不佳',{icon:2,time:1200,closeBtn:0});
                          }
                       layer.closeAll('loading');
                    },
                    error:function(){
                         layer.msg('无响应,网络不佳',{icon:2,time:1200,closeBtn:0});
                         layer.closeAll('loading');
                    },
                 });
              }

           },
           getEmailCode:function(){
              let email = $("#email").val();
              if(email == ''){
                 layer.msg('请输入邮箱',{icon:7,time:1200,closeBtn:0});
                 }
              else if(!reg_email.test(email)){
                 layer.msg('邮箱格式不规范，请输入正确的邮箱格式',{icon:7,time:1200,closeBtn:0});
                 }
              else{
                 layer.load(0, {time: 10000});
                 curCount1 = count;
                 $(".send_code").attr("disabled", "true");
                 $(".send_code").addClass("verify_ing");
                 $(".send_code").val(+curCount1 + "秒再获取");
                 InterValObj1 = window.setInterval(SetRemainTime1, 1000); //启动计时器，1秒执行一次
                 let data = {'email':email,'way':'email'};
                 let headers = {'X-CSRFToken':csrftoken};
                 let url = '/consumer/verification-code-chsc-api/';
                $.ajax({
                  url:url,
                  type:'POST',
                  headers:headers,
                  data:data,
                  success:function(data){
                     if(data.code === 7){
                        layer.msg('邮箱已被注册！',{icon:2,time:1200,closeBtn:0});
                        }
                     else if(data.code === 31){
                        layer.msg('验证码发送成功！',{icon:1,time:1000,closeBtn:0});
                        }
                     else if(data.code === 500){
                        layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                        }
                     layer.closeAll('loading');
                  },
                  error:function(){
                     layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                     layer.closeAll('loading');
                  },
                });
              }

           },
           getPhoneCode:function(){
              let phone = $("#phone").val();
              if(phone === ''){
                 layer.msg('请输入手机号',{icon:7,time:1200,closeBtn:0});
                 }
              else if(!reg_phone.test(phone)){
                 layer.msg('手机号码不规范，请输入正确的手机号',{icon:7,time:1200,closeBtn:0});
                 }
              else{
                 layer.load(0, {time: 10000});
                 curCount1 = count;
                 $("#dyPhoneButton").attr("disabled", "true");
                 $("#dyPhoneButton").addClass("verify_ing");
                 $("#dyPhoneButton").val(+curCount1 + "秒再获取");
                 InterValObj1 = window.setInterval(SetRemainTime1, 1000); //启动计时器，1秒执行一次
                 let data = {'phone':phone,'way':'phone'};
                 let headers = {'X-CSRFToken':csrftoken};
                 let url = '/consumer/verification-code-chsc-api/';
                 $.ajax({
                  url:url,
                  type:'POST',
                  headers:headers,
                  data:data,
                  success:function(data){
                     if(data.code === 7){
                        layer.msg('手机号已被注册！',{icon:2,time:1200,closeBtn:0});
                        }
                     else if(data.code === 31){
                        layer.msg('验证码发送成功！',{icon:1,time:1000,closeBtn:0});
                        }
                     else if(data.code === 500){
                        layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                        }
                     layer.closeAll('loading');
                  },
                  error:function(){
                     layer.msg('服务器无响应',{icon:2,time:1200,closeBtn:0});
                     layer.closeAll('loading');
                  },
                });
              }
           },

        };

        $("#login,#email_register,#phone_register,#dyMobileButton,#dyEmailButton,#register_tag,#login_tag").click(function(){
           let othis = $(this);
           let method = othis.data('method');
           active[method] ? active[method].call(this,othis):'';
        });

		  $(function() {
			  $('#doc-my-tabs').tabs();
		  })
      });
	});
	</script>
</html>